# add 'clean' to the current list of custom commands
export _docker_custom_commands="${_docker_custom_commands} clean"

#
# Clean docker containers and images
# http://stackoverflow.com/questions/17236796/how-to-remove-old-docker-containers
#
function docker-clean {

    EXITED=$(docker ps -a -q -f status=exited)
    EXITED_LIST=$(docker ps -a -f status=exited)

    DANGLING=$(docker images -q -f "dangling=true")
    DANGLING_LIST=$(docker images -f "dangling=true")

    DRY_RUN="0"
    EXECUTE="N"

    echo
    echo -e "\tThe following containers have exited and will be removed:"
    echo
    docker ps -a -f "status=exited"
    echo
    echo
    echo -e "\tThe following images are dangling and will be removed:"
    echo
    docker images -f "dangling=true"
    echo
    read -p "Do you want to remove the listed containers / images? [y/N]: " EXECUTE

    echo
    if [ "y" == "${EXECUTE}" ]; then
        if [ -n "$EXITED" ]; then
            docker rm $EXITED
        else
            echo "No containers to remove."
        fi
        if [ -n "$DANGLING" ]; then
            docker rmi $DANGLING
        else
            echo "No images to remove."
        fi
    fi
}

